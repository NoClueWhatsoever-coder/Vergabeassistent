<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Beschaffungsvorhaben – VergabeAssist</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Supabase JS laden -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:1em;">
    <a href="dashboard.html" style="text-decoration:none;color:#0077b6;font-weight:700;font-size:1.2em;">&#8592; Zurück zum Dashboard</a>
  </div>
  <div class="header-center">
    <a href="index.html" tabindex="0">
      <img src="img/logo_govdisrupt_ai.png" alt="GovDisrupt AI Logo" class="header-firm-logo" style="cursor:pointer;">
    </a>
  </div>
</header>

<main

  <!-- Projektdetails -->
  <section class="projekt-info" style="margin-bottom:2em;">
    <h2 id="projektTitel">Lädt...</h2>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.7em;">
      <div><b>Art:</b> <span id="projektArt">–</span></div>
      <div><b>Frist:</b> <span id="projektFrist">–</span></div>
      <div><b>Schätzwert:</b> <span id="projektSchaetzwert">–</span></div>
      <div><b>CPV-Code:</b> <span id="projektCPV">–</span></div>
    </div>
    <div style="margin-top:1em;display:flex;justify-content:space-between;align-items:center;">
      <div><b>Status:</b> <span id="projektStatus">–</span></div>
    </div>
  </section>

  <section class="projekt-formularexport" style="margin-bottom:2em;">
    <div class="collapsible-head" style="display:flex;align-items:center;gap:0.8em;cursor:pointer;">
      <h3 id="formExtraHead" style="margin:0;">Zusätzliche Angaben zum Projekt</h3>
      <span id="collapser" class="material-icons" style="transition:transform 0.19s;font-size:1.5em;user-select:none;">expand_less</span>
    </div>
    <div class="collapsible-content" id="formExtraContent" style="background:#eaf4fb;padding:1em 1.3em;border-radius:8px; margin-top:1em;">
      <!-- Deine Eingabefelder und Button wie gehabt... -->
      <label>
        <b>Baumaßnahme / Projekt:</b><br>
        <input type="text" id="baumaßnahmeInput" placeholder="z.B. Sanierung Turnhalle" style="width:80%;">
      </label>
      <br>
      <label>
        <b>Maßnahmenummer:</b><br>
        <input type="text" id="maßnahmeNrInput" placeholder="z.B. 2024-001" style="width:60%;">
      </label>
      <br>
      <label>
        <b>Vergabenummer:</b><br>
        <input type="text" id="vergabeNrInput" placeholder="z.B. 24-0112-03" style="width:60%;">
      </label>
      <div style="color:#4183a4;margin-top:0.7em;">
        <small>Hinweis: Diese Angaben werden später für Formblätter (z.B. VHB 124) und die automatische Formularbefüllung genutzt.<br>Sie sind <b>optional</b>, aber sehr empfohlen.</small>
      </div>
      <div style="margin-top:0.8em;">
        <button id="saveFormularFieldsBtn" style="padding:0.4em 1.3em;">Speichern</button>
        <span id="formularSaveStatus" style="color:#2a8826;font-size:1em;"></span>
      </div>
    </div>
  </section>


  <!-- Chatbereich -->
  <section class="chat-container">
    <div class="chat-header">
      <h3 style="display:inline;">Bedarfsbeschreibung</h3>
      <span class="material-icons info-icon" style="margin-left:0.5em;font-size:1.38em;vertical-align:-0.12em;cursor:help;color:#2777b6;"
            title="Bitte beschreibe deinen Bedarf so detailliert wie möglich oder lade eine Datei hoch.">
        info
      </span>
    </div>
    <div id="fileBubbleRow" class="filebubble-row"></div>
    <div id="chatMessages" class="chat-messages"></div>
    <div class="chat-input-bar">
      <textarea id="chatInput" placeholder="Beschreibung eingeben..." autocomplete="off"></textarea>
      <div class="chat-input-row">
        <!-- Datei-Uploadblock LINKS unter dem Textfeld -->
        <div class="chat-upload-block">
          <label class="upload-btn" title="Datei hinzufügen">
            <span class="upload-plus">+</span>
            <input type="file" id="fileUpload" accept=".txt,.docx,.pdf,.json,.xml,.x83,.xlsx,.csv" multiple />
          </label>
          <span class="upload-label">Datei auswählen</span>
        </div>
        <!-- Senden rechts unten -->
        <button id="sendBtn">Senden</button>
      </div>
    </div>
  </section>

  <!-- Aktionen: Nächste Schritte -->
  <div style="margin:2.2em 0 1em 0; text-align:center;">
    <h3>Nächste Schritte im Projekt</h3>
    <div style="display:flex;flex-wrap:wrap;gap:1.3em;justify-content:center;">
      <button id="btnVergabeUnterlagen" style="padding:1.1em 2.2em;font-size:1.1em;border-radius:12px;border:none;background:#0077b6;color:#fff;font-weight:600;box-shadow:0 2px 10px #0077b63b;cursor:pointer;">
        📄 Vergabeunterlagen erstellen
      </button>
      <button id="btnMarkterkundung" style="padding:1.1em 2.2em;font-size:1.1em;border-radius:12px;border:none;background:#4e80bb;color:#fff;font-weight:600;box-shadow:0 2px 10px #0077b63b;cursor:pointer;">
        🔍 Markterkundung (bald)
      </button>
      <button id="btnRechtsfragen" style="padding:1.1em 2.2em;font-size:1.1em;border-radius:12px;border:none;background:#b0bec5;color:#fff;font-weight:600;box-shadow:0 2px 10px #0077b63b;cursor:pointer;">
        ⚖️ Vergaberechtliche Fragen
      </button>
    </div>
    <div style="margin-top:1em;color:#777;">
      Wählen Sie die nächste Aktion für dieses Projekt.
    </div>
  </div>

<footer class="footer-modern">
  <div class="footer-inner">
    <div class="footer-brand">
      <img src="img/logo_govdisrupt_ai.png" alt="Firmenlogo" class="footer-logo">
      <span class="footer-app">VergabeAssist</span>
    </div>
    <nav class="footer-links">
      <a href="impressum.html" target="_blank">Impressum</a>
      <a href="datenschutz.html" target="_blank">Datenschutz</a>
      <a href="nutzungsbedingungen.html" target="_blank">Nutzungsbedingungen</a>
      <a href="avv.html" target="_blank">AVV</a>
    </nav>
    <nav class="footer-breadcrumb breadcrumb-nav" id="dynamicFooterBreadcrumb">
      <a href="index.html" class="breadcrumb-link">
        <span style="font-size:1.3em;vertical-align:middle;">🏠</span>
        Zurück zur Startseite
      </a>
      <span class="breadcrumb-sep" style="margin:0 0.7em;color:#b8c3d6;">›</span>
      <span class="breadcrumb-current" id="breadcrumbCurrent"></span>
    </nav>
  </div>
</footer>


<script src="js/projekt.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function(){
  const head = document.querySelector('.collapsible-head');
  const content = document.getElementById('formExtraContent');
  const collapser = document.getElementById('collapser');
  let collapsed = false;
  function setCollapsed(state) {
    collapsed = state;
    if (collapsed) {
      content.classList.add('collapsed');
      collapser.classList.add('rotate');
    } else {
      content.classList.remove('collapsed');
      collapser.classList.remove('rotate');
    }
  }
  head.onclick = () => setCollapsed(!collapsed);
  // Nach Speichern automatisch einklappen:
  const saveBtn = document.getElementById('saveFormularFieldsBtn');
  saveBtn && saveBtn.addEventListener('click', function(){
    setTimeout(() => setCollapsed(true), 600);
  });
});
</script>

</body>
</html>
