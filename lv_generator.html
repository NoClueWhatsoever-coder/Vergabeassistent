<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leistungsverzeichnis generieren ‚Äì VergabeAssist</title>
  <link rel="stylesheet" href="css/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
<header>
  <div id="burgerMenu" class="burger-menu" onclick="toggleSidebarMenu()">
    <span></span><span></span><span></span>
  </div>
  <div class="header-center">
    <a href="index.html" tabindex="0">
      <img src="img/logo_govdisrupt_ai.png" alt="GovDisrupt AI Logo" class="header-firm-logo" />
    </a>
  </div>
  <button id="loginTopBtn" class="login-top-btn" onclick="window.location.href='account.html'" aria-label="Account">
    <span class="material-icons" style="font-size:1.9em;vertical-align:middle;">account_circle</span>
    <span style="font-size:1em;margin-left:0.35em;">Account</span>
  </button>
</header>
<div id="sidebarOverlay" class="sidebar-overlay"></div>
<aside id="sidebarMenu" class="sidebar-menu-left">
  <nav class="sidebar-links">
    <a href="dashboard.html"><span class="material-icons">dashboard</span> Projekte</a>
    <a href="vorlagen.html"><span class="material-icons">collections_bookmark</span> Vorlagen</a>
    <a href="account.html"><span class="material-icons">person</span> Account</a>
  </nav>
</aside>

<main>
  <section>
    <h1>Leistungsverzeichnis generieren</h1>
    <!-- Chat-Box -->
    <section class="chat-container">
      <div class="chat-header" style="justify-content:flex-end;">
        <span class="material-icons info-icon" title="Geben Sie Ihr Projektbriefing ein oder laden Sie eine Datei hoch, um ein Leistungsverzeichnis zu generieren.">info</span>
      </div>
      <div id="fileBubbleRow" class="filebubble-row"></div>
      <div id="chatMessages" class="chat-messages"></div>
      <div class="chat-input-bar">
        <textarea id="chatInput" placeholder="Geben Sie hier Ihre Anfrage oder Ihr Projektbriefing ein‚Ä¶" autocomplete="off"></textarea>
        <div class="chat-input-row">
          <div class="chat-upload-block">
            <label class="upload-btn" title="Datei hinzuf√ºgen">
              <span class="upload-plus">+</span>
              <input type="file" id="fileUpload" multiple />
            </label>
            <span class="upload-label">Datei ausw√§hlen</span>
          </div>
          <button id="sendBtn">Senden</button>
        </div>
      </div>
    </section>
  </section>
</main>

<footer class="footer-modern">
  <div class="footer-inner">
    <div class="footer-brand">
      <img src="img/logo_govdisrupt_ai.png" alt="Firmenlogo" class="footer-logo" />
      <span class="footer-app">VergabeAssist</span>
    </div>
    <nav class="footer-links">
      <a href="impressum.html" target="_blank">Impressum</a>
      <a href="datenschutz.html" target="_blank">Datenschutz</a>
      <a href="nutzungsbedingungen.html" target="_blank">Nutzungsbedingungen</a>
      <a href="avv.html" target="_blank">AVV</a>
    </nav>
    <nav class="footer-breadcrumb breadcrumb-nav">
      <a href="index.html" class="breadcrumb-link"><span style="font-size:1.3em;vertical-align:middle;">üè†</span> Zur√ºck zur Startseite</a>
      <span class="breadcrumb-sep" style="margin:0 0.7em;color:#b8c3d6;">‚Ä∫</span>
      <span class="breadcrumb-current" id="breadcrumbCurrent"></span>
    </nav>
  </div>
</footer>

<script>
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const fileUpload = document.getElementById('fileUpload');
const fileBubbleRow = document.getElementById('fileBubbleRow');
function appendMessage(sender, text) {
  const msg = document.createElement('div');
  msg.classList.add('message', sender);
  const bubble = document.createElement('div');
  bubble.classList.add('bubble');
  if (sender === 'assistant' && window.marked) {
    bubble.innerHTML = marked.parse(text);
  } else {
    bubble.textContent = text;
  }
  msg.appendChild(bubble);
  if (sender === 'assistant') {
    const copyBtn = document.createElement('button');
    copyBtn.classList.add('copy-btn');
    copyBtn.innerHTML = '<span class="material-icons">content_copy</span>';
    copyBtn.title = 'Antwort kopieren';
    copyBtn.onclick = () => navigator.clipboard.writeText(bubble.innerText);
    msg.appendChild(copyBtn);
  }
  chatMessages.appendChild(msg);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}
function sendMessage() {
  const text = chatInput.value.trim();
  if (!text) return;
  appendMessage('user', text);
  chatInput.value = '';
  chatInput.focus();
  sendBtn.disabled = true;
  // Lade-Indikator anzeigen
  const loadingMsg = document.createElement('div');
  loadingMsg.classList.add('message', 'assistant');
  const loadingBubble = document.createElement('div');
  loadingBubble.classList.add('bubble');
  loadingBubble.innerHTML = '<span class="chat-hint">Analysiere ‚Ä¶</span>';
  loadingMsg.appendChild(loadingBubble);
  chatMessages.appendChild(loadingMsg);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  // Simulierte KI-Antwort
  setTimeout(() => {
    loadingMsg.remove();
    const reply = 'Der VergabeAssistent antwortet hier mit dem generierten Leistungsverzeichnis oder einer R√ºckfrage. (Demonstration)';
    appendMessage('assistant', reply);
    sendBtn.disabled = false;
  }, 1000);
}
chatInput.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
fileUpload.addEventListener('change', () => {
  fileBubbleRow.innerHTML = '';
  for (const file of fileUpload.files) {
    const fileBubble = document.createElement('div');
    fileBubble.classList.add('file-bubble');
    fileBubble.innerHTML =
      '<span class="material-icons file-icon">attach_file</span>' +
      '<span class="file-name">' + file.name + '</span>' +
      '<span class="file-type">.' + file.name.split('.').pop() + '</span>' +
      '<button type="button" class="file-remove">&times;</button>';
    fileBubbleRow.appendChild(fileBubble);
    fileBubble.querySelector('.file-remove').onclick = () => {
      fileUpload.value = '';
      fileBubbleRow.innerHTML = '';
    };
  }
});
function toggleSidebarMenu(force = false) {
  const sidebar = document.getElementById('sidebarMenu');
  const overlay = document.getElementById('sidebarOverlay');
  const isOpen = sidebar.classList.contains('open');
  if (isOpen || force) {
    sidebar.classList.remove('open');
    overlay.classList.remove('active');
    document.body.classList.add('sidebar-closed');
    sessionStorage.setItem('sidebarMenuClosed', '1');
  } else {
    sidebar.classList.add('open');
    overlay.classList.add('active');
    document.body.classList.remove('sidebar-closed');
    sessionStorage.removeItem('sidebarMenuClosed');
    setTimeout(() => sidebar.focus && sidebar.focus(), 120);
  }
}
document.addEventListener('DOMContentLoaded', () => {
  if (!sessionStorage.getItem('sidebarMenuClosed')) {
    document.getElementById('sidebarMenu').classList.add('open');
    document.getElementById('sidebarOverlay').classList.add('active');
  } else {
    document.body.classList.add('sidebar-closed');
  }
});
document.getElementById('sidebarOverlay').onclick = () => toggleSidebarMenu(true);
document.addEventListener('keydown', e => { if (e.key === 'Escape') toggleSidebarMenu(true); });
(function() {
  let title = document.title || '';
  if (title.indexOf('‚Äì') > 0) title = title.split('‚Äì')[0].trim();
  document.getElementById('breadcrumbCurrent').textContent = title;
})();
</script>
</body>
</html>
